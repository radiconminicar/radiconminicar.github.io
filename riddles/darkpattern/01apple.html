<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>1問目</title>
<style>
  body {
    font-family: sans-serif;
    text-align: center;
    margin: 0;
  }
  h1 {
    margin-top: 20px;
    font-size: 2rem;
  }
  img {
    width: 300px;
    cursor: pointer;
  }

  /* 共通モーダル（背景＋アニメーション） */
  .modal {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(5px);
    opacity: 0;
    pointer-events: none;
    transition: opacity 240ms ease;
    z-index: 1000;
  }
  .modal.show {
    opacity: 1;
    pointer-events: auto;
  }

  /* モーダル内部カードのアニメーション */
  .modal-card {
    background: #fff;
    border-radius: 10px;
    padding: 18px;
    box-sizing: border-box;
    transform: translateY(12px) scale(0.98);
    transition: transform 240ms cubic-bezier(.2,.9,.3,1);
    max-width: 92vw;
    width: min(900px, 92vw);
    max-height: 86vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  .modal.show .modal-card {
    transform: translateY(0) scale(1);
  }

  /* 画像モーダル用 */
  .modal-image .modal-card {
    padding: 16px;
    align-items: center;
  }
  .modal-image img {
    max-width: calc(100% - 32px);
    max-height: calc(100% - 32px);
    width: auto;
    height: auto;
    object-fit: contain;
    box-shadow: 0 0 20px rgba(0,0,0,0.25);
    border-radius: 8px;
  }

  /* 確認モーダル用（テキスト中央揃え＋スクロール可能） */
  .confirm-body {
    padding: 8px 6px;
    overflow: auto;
    text-align: center;
    line-height: 1.6;
    color: #111;
  }
  .confirm-body .answer-red {
    color: red;
    font-weight: 700;
  }

  /* 確認モーダルのボタン群 */
  .confirm-actions {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-top: 12px;
    flex-shrink: 0;
  }
  .btn {
    padding: 8px 14px;
    font-size: 15px;
    border-radius: 6px;
    border: 1px solid #bbb;
    background: #fff;
    cursor: pointer;
  }
  .btn-primary {
    background: #0066cc;
    color: white;
    border-color: #005bb5;
  }
  .btn-cancel {
    background: #f3f3f3;
  }

  /* エラーメッセージ */
  #error-message {
    color: red;
    margin-top: 8px;
    font-size: 0.9rem;
  }

  /* 小さい画面での調整 */
  @media (max-width: 420px) {
    .modal-card { padding: 12px; }
    .btn { padding: 8px 10px; font-size: 14px; }
  }
</style>
</head>
<body>
  <h1>1問目</h1>

  <img id="puzzle-img" src="darkpattern_images/q1.png" alt="q1">

  <div style="margin-top: 20px;">
    <input id="answer-input" type="text" placeholder="解答をひらがなで入力" />
    <button id="primary-send" class="btn btn-primary">送信</button>
    <div id="error-message"></div>
  </div>

  <!-- 画像拡大用モーダル -->
  <div id="modal-image" class="modal modal-image" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-label="画像の拡大">
      <img id="modal-image-img" src="darkpattern_images/q1.png" alt="">
      <p style="margin:10px 0 0 0; font-size:0.95rem; color:#555;">画面外をクリックして閉じる</p>
    </div>
  </div>

  <!-- 送信確認モーダル -->
  <div id="modal-confirm" class="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-label="送信確認">
      <div class="confirm-body" id="confirm-body">
        <!-- JSで挿入 -->
      </div>
      <div class="confirm-actions">
        <button id="confirm-send" class="btn btn-primary">送信</button>
        <button id="confirm-cancel" class="btn btn-cancel">キャンセル</button>
      </div>
    </div>
  </div>

<script>
  // 画像モーダル
  const puzzleImg = document.getElementById('puzzle-img');
  const modalImage = document.getElementById('modal-image');

  puzzleImg.addEventListener('click', () => {
    modalImage.classList.add('show');
  });

  modalImage.addEventListener('click', (e) => {
    if (e.target === modalImage) modalImage.classList.remove('show');
  });

  // 確認モーダル
  const primarySend = document.getElementById('primary-send');
  const answerInput = document.getElementById('answer-input');
  const modalConfirm = document.getElementById('modal-confirm');
  const confirmBody = document.getElementById('confirm-body');
  const confirmSend = document.getElementById('confirm-send');
  const confirmCancel = document.getElementById('confirm-cancel');
  const errorMessage = document.getElementById('error-message');

  primarySend.addEventListener('click', () => {
    const answertext = answerInput.value.trim();
    errorMessage.textContent = ''; // リセット

    if (answertext === '') {
      errorMessage.textContent = '解答を入力してください。';
      return;
    }

    confirmBody.innerHTML = `
      <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:120px;">
        <div style="max-width:86vw; text-align:center;">
          『<span class="answer-red">${escapeHtml(answertext)}</span>』を送信します。よろしいですか？
        </div>
        <div style="margin-top:12px; text-align:left; max-height:44vh; overflow:auto; border-top:1px solid rgba(0,0,0,0.06); padding-top:12px;">
          <ol style="padding-left:18px; margin:0 12px 0 12px; color:#222;">
            <li>以下の送信ボタンをもう一度押すことにより、この解答が送信されます。</li>
            <li>この解答を送信することにより生じる不具合の一切について、この問題の制作者は責任を負いません。</li>
            <li>山形を適用し忘れたことにより不具合が生じたとしても、我々は責任を負いません。</li>
            <li>解答が正解であった場合、自動的に会員登録を行います。</li>
          </ol>
        </div>
      </div>
    `;
    modalConfirm.classList.add('show');
    confirmSend.focus();
  });

  modalConfirm.addEventListener('click', (e) => {
    if (e.target === modalConfirm) modalConfirm.classList.remove('show');
  });

  confirmCancel.addEventListener('click', () => {
    modalConfirm.classList.remove('show');
  });

  confirmSend.addEventListener('click', () => {
    const sentText = answerInput.value.trim();
    if (sentText === 'あとだし') {
      window.location.href = '02banana.html';
    } else {
      modalConfirm.classList.remove('show');
      errorMessage.textContent = '不正解です。';
    }
  });

  function escapeHtml(str) {
    if (!str) return '';
    return String(str)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#39;');
  }
</script>
</body>
</html>
